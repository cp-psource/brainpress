/*! BrainPress - v2.2.2
 * https://github.com/cp-psourcepiestingtal_source/ps-brainpress-classicpress-lms-online-akademie-plugin/
 * Copyright (c) 2019; * Licensed GPLv2+ */
var BrainPress=BrainPress||{};!function(a){function b(){var b=a('[data-type="modal-step"]');void 0!==b&&b.length&&(BrainPress.Enrollment.Modal=Backbone.Modal.extend({template:_.template(a("#modal-template").html()),viewContainer:".enrollment-modal-container",submitEl:".done",cancelEl:".cancel",options:"meh",views:function(){var c={};return a.each(b,function(b,d){var e=b+1,f=a(d).attr("id");void 0!==f&&(c["click #step"+e]={view:_.template(a("#"+f).html()),onActive:"setActive"})}),c}(),events:{"click .previous":"previousStep","click .next":"nextStep","click .cancel-link":"closeDialog"},previousStep:function(a){a.preventDefault(),this.previous(),"function"==typeof this.onPrevious&&this.onPrevious()},nextStep:function(a){a.preventDefault(),this.next(),"function"==typeof this.onNext&&this.onNext()},closeDialog:function(){a(".enrolment-container-div").detach()},setActive:function(a){this.trigger("modal:updated",{view:this,options:a})},cancel:function(){a(".enrolment-container-div").detach()}}),BrainPress.Enrollment.dialog=new BrainPress.Enrollment.Modal,BrainPress.Enrollment.dialog.beforeSubmit=function(){var b=this.currentIndex;return d(b),b===BrainPress.Enrollment.dialog.views.length-1&&a(".enrolment-container-div").addClass("hidden"),!1},BrainPress.Enrollment.dialog.openAtAction=function(b){var c=a('[data-type="modal-step"]');a.each(c,function(c,d){var e=a(d).attr("data-modal-action");void 0!==e&&b===e&&BrainPress.Enrollment.dialog.openAt(c)})},BrainPress.Enrollment.dialog.on("modal:updated",function(){}),BrainPress.Enrollment.dialog.handle_signup_return=function(b){var c=b.signup_errors,d=a('[data-type="modal-step"]');if(0===c.length&&!0===b.user_data.logged_in)_brainpress.invitation_data?BrainPress.Enrollment.dialog.add_instructor(b):a.each(d,function(c,d){var e=a(d).attr("data-modal-action");"yes"===_brainpress.current_course_is_paid&&"paid_enrollment"===e?BrainPress.Enrollment.dialog.openAt(c):"enrolled"===e&&(b.already_enrolled?location.href=_brainpress.course_url:BrainPress.Enrollment.dialog.attempt_enroll(b))});else if(c.length>0){a(".bbm-wrapper #error-messages").html("");var e="<ul>";c.forEach(function(a){e+="<li>"+a+"</li>"}),e+="</ul>",a(".bbm-wrapper #error-messages").html(e),a("input[name=password]").val(""),a("input[name=password_confirmation]").val("")}else a.each(d,function(a,b){"login"===b.attr("data-modal-action")&&BrainPress.Enrollment.dialog.openAt(a)})},BrainPress.Enrollment.dialog.handle_login_return=function(b){var c=b.signup_errors,d=a('[data-type="modal-step"]');if(0===c.length&&!0===b.logged_in)_brainpress.invitation_data?BrainPress.Enrollment.dialog.add_instructor(b):a.each(d,function(c,d){var e=a(d).attr("data-modal-action");"yes"===_brainpress.current_course_is_paid&&"paid_enrollment"===e?BrainPress.Enrollment.dialog.openAt(c):"enrolled"===e&&(b.already_enrolled?location.href=_brainpress.course_url:BrainPress.Enrollment.dialog.attempt_enroll(b))});else if(c.length>0){a(".bbm-wrapper #error-messages").html("");var e="<ul>";c.forEach(function(a){e+="<li>"+a+"</li>"}),e+="</ul>",a(".bbm-wrapper #error-messages").html(e),a("input[name=password]").val("")}},BrainPress.Enrollment.dialog.handle_enroll_student_return=function(b){var c=a('[data-type="modal-step"]');!0===b.success&&a.each(c,function(b,c){var d=a(c).attr("data-modal-action");"yes"===_brainpress.current_course_is_paid&&"paid_enrollment"===d?BrainPress.Enrollment.dialog.openAt(b):"enrolled"===d&&BrainPress.Enrollment.dialog.openAt(b)}),a(".enrolment-container-div").removeClass("hidden")},BrainPress.Enrollment.dialog.signup_validation=function(){var b=!0;a(".bbm-wrapper #error-messages").html("");var c=[];""!==a("input[name=first_name]").val().trim()&&""!==a("input[name=last_name]").val().trim()&&""!==a("input[name=username]").val().trim()&&""!==a("input[name=email]").val().trim()&&""!==a("input[name=password]").val().trim()&&""!==a("input[name=password_confirmation]").val().trim()||(b=!1,c.push(_brainpress.signup_errors.all_fields));var d=BrainPress.utility.checkPasswordStrength(a("input[name=password]"),a("input[name=password_confirmation]"),a("#password-strength"),!1,[]);if(d<=2&&(b=!1,c.push(_brainpress.signup_errors.weak_password)),5===d&&(b=!1,c.push(_brainpress.signup_errors.mismatch_password)),c.length>0){var e="<ul>";c.forEach(function(a){e+="<li>"+a+"</li>"}),e+="</ul>",a(".bbm-wrapper #error-messages").html(e)}return b},BrainPress.Enrollment.dialog.login_validation=function(){var b=!0;return a(".bbm-wrapper #error-messages").html(""),""!==a("input[name=log]").val().trim()&&""!==a("input[name=pwd]").val().trim()||(b=!1),b},BrainPress.Enrollment.dialog.signup_data=function(b){return b.first_name=a("input[name=first_name]").val(),b.last_name=a("input[name=last_name]").val(),b.username=a("input[name=username]").val(),b.email=a("input[name=email]").val(),b.password=a("input[name=password]").val(),b.nonce=a(".bbm-modal-nonce.signup").attr("data-nonce"),b},BrainPress.Enrollment.dialog.login_data=function(b){var c=a(".enrollment-modal-container.bbm-modal__views").attr("data-course");return b.username=a("input[name=log]").val(),b.password=a("input[name=pwd]").val(),b.course_id=c,b.nonce=a(".bbm-modal-nonce.login").attr("data-nonce"),b},BrainPress.Enrollment.dialog.attempt_enroll=function(b){var c=a(".enrollment-modal-container.bbm-modal__views").attr("data-nonce"),d=a(".enrollment-modal-container.bbm-modal__views").attr("data-course");if(void 0===c||void 0===d){var e=a(document.createElement("div"));e.html(_.template(a("#modal-template").html())()),e=a(e).find(".enrollment-modal-container")[0],c=a(e).attr("data-nonce"),d=a(e).attr("data-course")}BrainPress.Post.prepare("course_enrollment","enrollment:"),BrainPress.Post.set("action","enroll_student");var f={nonce:c,student_id:b.user_data.ID,course_id:d,step:""};BrainPress.Post.set("data",f),BrainPress.Post.save(),BrainPress.Post.off("brainpress:enrollment:enroll_student_success"),BrainPress.Post.on("brainpress:enrollment:enroll_student_success",function(b){if(a(".enrollment-modal-container.bbm-modal__views").attr("data-nonce",b.nonce),void 0!==b.callback){var c=BrainPress.Enrollment.dialog[b.callback];if("function"==typeof c)return void c(b)}})},BrainPress.Enrollment.dialog.new_nonce=function(a,b){BrainPress.Post.prepare("course_enrollment","enrollment:"),BrainPress.Post.set("action","get_nonce");var c={action:"get_nonce",nonce:a,step:""};BrainPress.Post.set("data",c),BrainPress.Post.save(),BrainPress.Post.off("brainpress:enrollment:get_nonce_success"),BrainPress.Post.on("brainpress:enrollment:get_nonce_success",b)},BrainPress.Enrollment.dialog.add_instructor=function(a){BrainPress.Enrollment.dialog.new_nonce("brainpress_add_instructor",function(b){var c=_brainpress.invitation_data.course_id;BrainPress.Post.prepare("course_enrollment","enrollment:"),BrainPress.Post.set("action","add_instructor");var d={action:"add_instructor",nonce:b.nonce,course_id:c,invite_code:_brainpress.invitation_data.code,instructor_id:a.user_data.ID,step:""};BrainPress.Post.set("data",d),BrainPress.Post.save(),BrainPress.Post.off("brainpress:enrollment:add_instructor_success"),BrainPress.Post.on("brainpress:enrollment:add_instructor_success",function(){BrainPress.Enrollment.dialog.openAtAction("instructor-verified")}),BrainPress.Post.off("brainpress:enrollment:add_instructor_error"),BrainPress.Post.on("brainpress:enrollment:add_instructor_error",function(){BrainPress.Enrollment.dialog.openAtAction("verification-failed")})})},a("body").on("keyup","input[name=password], input[name=password_confirmation]",function(){BrainPress.utility.checkPasswordStrength(a("input[name=password]"),a("input[name=password_confirmation]"),a("#password-strength"),!1,[])}))}function c(){var b=a(document.createElement("div"));if(a("body").append(b),a(b).addClass("enrolment-container-div"),_brainpress.current_student>0)if("yes"===_brainpress.current_course_is_paid)a(b).html(BrainPress.Enrollment.dialog.render().el),BrainPress.Enrollment.dialog.openAtAction("paid_enrollment");else{a(b).addClass("hidden");var c={user_data:{ID:parseInt(_brainpress.current_student)}};BrainPress.Enrollment.dialog.attempt_enroll(c),a(b).html(BrainPress.Enrollment.dialog.render().el)}else a(b).html(BrainPress.Enrollment.dialog.render().el)}function d(b){if(void 0===b)return!1;var c,d=a(a('[data-type="modal-step"]')[b]).attr("data-modal-action"),e=a(".enrollment-modal-container.bbm-modal__views").attr("data-nonce");if(BrainPress.Post.prepare("course_enrollment","enrollment:"),BrainPress.Post.set("action",d),!("signup"===d&&"function"==typeof(c=BrainPress.Enrollment.dialog.signup_validation)&&!0!==c()||"login"===d&&"function"==typeof(c=BrainPress.Enrollment.dialog.login_validation)&&!0!==c())){var f={nonce:e,step:b};c=BrainPress.Enrollment.dialog[d+"_data"],"function"==typeof c&&(f=c(f)),BrainPress.Post.set("data",f),BrainPress.Post.save(),BrainPress.Post.on("brainpress:enrollment:"+d+"_success",function(b){if(a(".enrollment-modal-container.bbm-modal__views").attr("data-nonce",b.nonce),void 0!==b.callback&&"function"==typeof(c=BrainPress.Enrollment.dialog[b.callback]))return void c(b);void 0!==b.last_step&&parseInt(b.last_step)<BrainPress.Enrollment.dialog.views.length-1&&(BrainPress.Enrollment.dialog.openAt(parseInt(b.last_step)+1),a(".enrolment-container-div").removeClass("hidden"))}),BrainPress.Post.on("brainpress:enrollment:"+d+"_error",function(a){if(void 0!==a.callback&&"function"==typeof(c=BrainPress.Enrollment.dialog[a.callback]))return void c(a)})}}function e(){BrainPress.Post.on("brainpress:notification:delete_success",function(){window.location.reload()})}function f(){a(".unit-archive-list-wrapper .section-title").on("click",function(){var b=a(a(a(this).parents(".unit-archive-single")[0]).find("a.unit-archive-single-title")[0]).attr("href"),c="section-"+a(this).attr("data-id");a(this).find("a.unit-archive-single-title").length>0&&(window.location.href=b+"#"+c)}),a(".unit-archive-list-wrapper .module-title").on("click",function(){var b=a(a(a(this).parents(".unit-archive-single")[0]).find("a.unit-archive-single-title")[0]).attr("href"),c="module-"+a(this).attr("data-id");if(a(this).find("a.unit-archive-single-title").length>0&&(window.location.href=b+"#"+c),"focus"==a(".unit-archive-list-wrapper").data("view-mode")){var d=a("a",a(this)).attr("href").split("#"),b=a(a(a(this).parents(".unit-archive-single")[0]).find("a.unit-archive-single-title")[0]).attr("href")+"#"+d[1];window.location.href=b}}),a(".apply-button.signup, .apply-button.enroll").on("click",function(a){a=a||window.event,a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),c()}),a(".apply-button").on("click",function(b){var c=b.currentTarget;a(c).attr("data-link")&&(window.location.href=a(c).attr("data-link"))}),a("button").on("click",function(b){var c=b.currentTarget;a(c).attr("data-link")&&(window.location.href=a(c).attr("data-link"))}),a(".course_list_box_item.clickable").on("click",function(b){var c=b.currentTarget;a(c).attr("data-link")&&(window.location.href=a(c).attr("data-link"))}),a(".li-locked-unit a").on("click",function(a){a.stopImmediatePropagation(),a.preventDefault()}),a(".workbook-table .view-response").link_popup({link_text:'<span class="dashicons dashicons-visibility"></span>',offset_x:-160}),a(".workbook-table .feedback").link_popup({link_text:'<span class="dashicons dashicons-admin-comments"></span>'}),g(),a(".course-message-container .course-message-close").on("click",function(){a(this).parent().slideUp()}),a(".unit-archive-single .fold").on("click",function(){var b=a(">ul",a(this).parent()),c=a(".unit-archive-single-title",a(this).parent()),d=a(".unit-archive-module-wrapper",a(this).parent()),e=a(this);return e.hasClass("folded")?b.slideDown(function(){e.removeClass("folded"),e.closest("li").removeClass("folded").addClass("unfolded"),c.attr("href",c.data("original-href")),c.off("click")}):b.slideUp(function(){if(e.addClass("folded"),e.closest("li").removeClass("unfolded").addClass("folded"),void 0===c.data("href")){var b=a(".module-seen",d).last();if(b.length&&(b=a(".module-title",b),b.length))return c.attr("href",c.attr("href")+"#module-"+b.data("id")),!1;var f=a(".section-seen",d).last();if(f.length&&(f=a(".section-title",f),f.length))return c.attr("href",c.attr("href")+"#section-"+f.data("id")),!1}}),!1}),a(".course-structure .unit .fold").on("click",function(){var b=a(this),c=b.parents("li").first(),d=c.find(".unit-structure-modules");c.is(".folded")?(c.removeClass("folded").addClass("unfolded"),b.removeClass("folded"),d.slideDown()):(c.removeClass("unfolded").addClass("folded"),b.addClass("folded"),d.slideUp())}),a(".brainpress-focus-view #commentform #submit").unbind("click").on("click",function(){var b,c=a(this).closest("form");if(""==a("#comment",c).val())return alert(_brainpress.comments.require_valid_comment),!1;a("#respond #cancel-comment-reply-link").hide(),c.append('<div class="mask"><span><i class="fa fa-spinner fa-pulse"></i></span></div>'),b=a(".mask",c),b.css({width:c.width()+"px",height:c.height()+"px"}),a("span",b).css({marginTop:c.height()/2-20+"px"});var d=new BrainPress.Models.CourseFront;return d.set("action","comment_add_new"),d.set("comment_parent",a("#comment_parent",c).val()),d.set("comment_post_ID",a("#comment_post_ID",c).val()),d.set("comment_content",a("#comment",c).val()),d.set("brainpress_subscribe",a("[name=brainpress_subscribe]",c).val()),d.set("nonce",a("#brainpress-add-commment-nonce",c).val()),d.save(),d.off("brainpress:comment_add_new_success"),d.on("brainpress:comment_add_new_success",function(b){var d=a(".focus-nav-next.module-is-not-done");if("single-comment"==b.answer_mode){if(0==b.data.comment_parent){0<a("#comments .comments-list").length?a("#comments .comments-list").prepend(b.data.html):BrainPress.FocusMode.init_focus_mode()}else comment_parent=a("#comment-"+b.data.comment_parent),0==a(".children",comment_parent).length&&comment_parent.append('<ul class="children"></ul>'),a(".children",comment_parent).first().append(b.data.html),a(".comments-list").before(a("#respond"));a("#comment").val(""),a("#comment_parent").val(0);var e,g=a("#comment-"+b.data.comment_id);0<g.length&&(e=g.offset().top,a(window).scrollTop(e))}else a("#comments .comments-list-container").html(b.data.html);f(),a(".mask",c).detach(),0<d.length&&(a(".brainpress-focus-view .focus-nav-next").replaceWith(b.data.next_nav),BrainPress.FocusMode.bind_focus_nav()),BrainPress.Events.trigger("brainpress:module_change",b)}),d.on("brainpress:comment_add_new_error",function(){b.detach(),a("#respond #cancel-comment-reply-link").show()}),!1}),a("label.file").on("change","input[type=file]",function(){var b=a("span",a(this).parent());return a(this).val().length?b.html(b.data("change")):b.html(b.data("upload")),!0})}function g(){void 0!==_brainpress.marketpress_is_used&&"no"!==_brainpress.marketpress_is_used&&a("body.single-course button.mp_button-addcart").on("click",function(){var b=a(this).closest("form");return a.ajax({type:"POST",url:b.data("ajax-url"),data:{product:a("[name=product_id]",b).val(),cart_action:"add_item"}}).done(function(a){a.success&&void 0!==_brainpress.marketpress_cart_url&&window.location.assign(_brainpress.marketpress_cart_url)}),!1})}function h(){a(".module-container .module-result .resubmit a").on("click",function(){var b=a(this).parents(".module-container"),c=a(b).find(".module-elements"),d=a(b).find(".module-response"),e=a(b).find(".module-result");a(c).removeClass("hide"),a(d).addClass("hide"),a(e).addClass("hide")}),a(".module-container input[type=file]").on("change",function(){var b=a(this).parents(".module-container"),c=a(this).val(),d=c.split(".").pop(),e=_.keys(_brainpress.allowed_student_extensions),f=e.join(", "),g=a(b).find(".upload-progress"),h=_.contains(e,d),i=a(".module-submit-action",a(this).closest(".module-elements")).parent();a(g).find(".invalid-extension").detach(),h?i.closest("form").addClass("is-valid-file"):(a(g).append('<span class="invalid-extension">'+_brainpress.invalid_upload_message+f+"</span>"),i.closest("form").removeClass("is-valid-file"))}),a(".module-submit-action").on("click",function(){return})}function i(){var b=a("ul.units-archive-list a").css("color"),c=a("body").css("color").replace("rgb(","").replace(")","").split(","),d="rgba("+c[0]+", "+c[1]+", "+c[2]+", 1)";a(".course-progress-disc").each(function(){var c=a(this).data(),e=b,f="center",g=4.5,h=!0,i={duration:1200,easing:"circleProgressEase"};c.knobFgColor&&(b=c.knobFgColor),c.knobEmptyColor&&(d=c.knobEmptyColor),c.knobTextColor&&(e=c.knobTextColor),c.knobTextAlign&&(f=c.knobTextAlign),c.knobTextDenominator&&(g=c.knobTextDenominator),void 0!==c.knobTextShow&&(h=c.knobTextShow),void 0!==c.knobAnimation&&(i=c.knobAnimation);var j={color:b};a(this).circleProgress({fill:j,emptyFill:d,animation:i});a(this).parents("ul")[0];a(this).on("circle-animation-progress",function(b,c){var d=a(this).data("circle-progress"),i=d.ctx,j=d.size,k=(100*c).toFixed(),l=(100*d.value).toFixed();k=100-k,k<l&&(k=l),i.save(),h&&(i.font=j/g+"px sans-serif",i.textAlign=f,i.textBaseline="middle",i.fillStyle=e,i.fillText(k+"%",j/2+j/80,j/2)),i.restore()}),a(this).on("circle-animation-end",function(){var b=a(this).data("circle-progress"),c=b.ctx,d=b.size,i=(100*b.value).toFixed();b.drawFrame(b.value),h&&(c.font=d/g+"px sans-serif",c.textAlign=f,c.textBaseline="middle",c.fillStyle=e,c.fillText(i+"%",d/2,d/2))});var k=a(this).data("circle-progress"),l=k.ctx,m=k.size,n=(100*k.value).toFixed();h&&(l.font=m/g+"px sans-serif",l.textAlign=f,l.textBaseline="middle",l.fillStyle=e,l.fillText(n+"%",m/2,m/2+m/80)),void 0!==c.knobTextPrepend&&c.knobTextPrepend&&a(this).parent().prepend('<span class="progress">'+n+"%</span>")})}function j(){a(".course-discussion-content.new .button-links .submit-discussion").on("click",function(){a(this).parents("form").submit()})}function k(){var b=a(".brainpress-focus-view");void 0!==b&&b.length>0&&BrainPress.FocusMode.init_focus_mode()}BrainPress.Models=BrainPress.Models||{},BrainPress.UI=BrainPress.UI||{},BrainPress.utility=BrainPress.utility||{},BrainPress.Events=BrainPress.Events||{},BrainPress.utility.timer_validate=function(a,b){return"ref_"+(BrainPress.utility.hashcode(""+a)+"").split("").reverse().join("")===b},BrainPress.utility.checkPasswordStrength=function(a,b,c,d,e){var f=a.val(),g=b.val();d&&d.attr("disabled","disabled"),c.removeClass("short bad good strong"),e=e.concat(wp.passwordStrength.userInputBlacklist());var h=wp.passwordStrength.meter(f,e,g);switch(h){case 2:c.addClass("bad").html(pwsL10n.bad);break;case 3:c.addClass("good").html(pwsL10n.good);break;case 4:c.addClass("strong").html(pwsL10n.strong);break;case 5:c.addClass("short").html(pwsL10n.mismatch);break;default:c.addClass("short").html(pwsL10n.short)}return d&&2<h&&5!==h&&""!==g.trim()&&d.removeAttr("disabled"),h},BrainPress.actions=BrainPress.actions||{},BrainPress.filters=BrainPress.filters||{},BrainPress.add_action=function(a,b,c){void 0===c&&(c=10),BrainPress.actions[a]=BrainPress.actions[a]||[],BrainPress.actions[a].push({priority:c,callback:b})},BrainPress.add_filter=function(a,b,c){void 0===c&&(c=10),BrainPress.filters[a]=BrainPress.filters[a]||[],BrainPress.filters[a].push({priority:c,callback:b})},BrainPress.remove_action=function(a,b){BrainPress.filters[a]=BrainPress.filters[a]||[],BrainPress.filters[a].forEach(function(c,d){c.callback===b&&BrainPress.filters[a].splice(d,1)})},BrainPress.remove_filter=function(a,b){BrainPress.filters[a]=BrainPress.filters[a]||[],BrainPress.filters[a].forEach(function(c,d){c.callback===b&&BrainPress.filters[a].splice(d,1)})},BrainPress.do_action=function(a,b){var c=[];void 0!==BrainPress.actions[a]&&BrainPress.actions[a].length>0&&(BrainPress.actions[a].forEach(function(a){c[a.priority]=c[a.priority]||[],c[a.priority].push(a.callback)}),c.forEach(function(a){a.forEach(function(a){a(b)})}))},BrainPress.apply_filters=function(a,b,c){var d=[];return void 0!==BrainPress.filters[a]&&BrainPress.filters[a].length>0&&(BrainPress.filters[a].forEach(function(a){d[a.priority]=d[a.priority]||[],d[a.priority].push(a.callback)}),d.forEach(function(a){a.forEach(function(a){b=a(b,c)})})),b},BrainPress.Models.CourseFront=Backbone.Model.extend({url:_brainpress._ajax_url+"?action=course_front",parse:function(a){!0===a.success?(this.set("response_data",a.data),this.trigger("brainpress:"+a.data.action+"_success",a.data)):(this.set("response_data",{}),a.data&&this.trigger("brainpress:"+a.data.action+"_error",a.data))},defaults:{}}),BrainPress.Models.Post=BrainPress.Models.Post||Backbone.Model.extend({url:_brainpress._ajax_url+"?action=",parse:function(a){var b=this.get("context");if(!0===a.success){void 0===a.data&&(a.data={}),this.set("response_data",a.data);var c="brainpress:"+b+a.data.action+"_success";this.trigger(c,a.data)}else 0!==a&&(this.set("response_data",{}),this.trigger("brainpress:"+b+a.data.action+"_error",a.data));BrainPress.Post.set("action","")},prepare:function(a,b){this.url=this.get("base_url")+a,void 0!==b&&this.set("context",b)},defaults:{base_url:_brainpress._ajax_url+"?action=",context:"response:"}}),BrainPress.Post=new BrainPress.Models.Post,BrainPress.Enrollment=BrainPress.Enrollment||{},BrainPress.Page=BrainPress.Page||{},BrainPress.Enrollment.dialog=BrainPress.Enrollment.dialog||{},BrainPress.FocusMode=BrainPress.FocusMode||{},BrainPress.FocusMode.bind_focus_nav=function(){a(".brainpress-focus-view .focus-nav-prev").off("click"),a(".brainpress-focus-view .focus-nav-next").off("click"),a(".brainpress-focus-view .focus-nav-reload").off("click"),a(".brainpress-focus-view a.breadcrumb-course-unit-section.crumb").off("click"),a(".brainpress-focus-view a.nav-go-back-link").off("click"),a(".brainpress-focus-view a.nav-go-back-link").on("click",function(b){b.preventDefault();var c=a(this).attr("href");return window.location.href=c,window.location.reload(),!1}),a(".brainpress-focus-view .focus-nav-prev, .brainpress-focus-view .focus-nav-next, .brainpress-focus-view .focus-nav-reload").on("click",function(){if(a(this).hasClass("module-is-not-done")){b();var c=a(document.createElement("div"));return a("body").append(c),a(c).addClass("enrolment-container-div"),a(c).html(BrainPress.Enrollment.dialog.render().el),BrainPress.Enrollment.dialog.openAtAction("mandatory"),!1}var d=a(".brainpress-focus-view"),e=a(this).attr("data-type"),f=a(this).attr("data-id"),g=a(this).attr("data-unit"),h=d.attr("data-unit"),i=a(this).attr("data-url"),j=0;if(e||f){if(a(".brainpress-focus-view .loader").removeClass("hidden"),a(".brainpress-focus-view .focus-main").hide("fast"),g&&g.length&&i&&h&&g!==h)return a("body,html").animate({scrollTop:j,duration:100}),window.location.href=i,!1;i&&i.length&&d.attr("data-url",i),j=a(".entry-title").length>0?a(".entry-title").offset().top-32:32,j=BrainPress.apply_filters("brainpress_focus_top_offset",j),a("body,html").animate({scrollTop:j,duration:100}),BrainPress.FocusMode.load_focus_item(e,f)}}),a("a.breadcrumb-course-unit-section.crumb, a.breadcrumb-course-unit.crumb").on("click",function(){var b="section",c=a(this).attr("data-id");a(".brainpress-focus-view .loader").removeClass("hidden"),a(".brainpress-focus-view .focus-main").hide("fast");var d=0;d=a(".entry-title").length>0?a(".entry-title").offset().top-32:32,d=BrainPress.apply_filters("brainpress_focus_top_offset",d),a("body,html").animate({scrollTop:d,duration:100}),BrainPress.FocusMode.load_focus_item(b,c)})},BrainPress.FocusMode.load_focus_item=function(b,c){function d(){BrainPress.FocusMode.bind_focus_nav(),BrainPress.Page.init(),a("audio").css("visibility","visible"),a("audio").css("outline","none"),a(".quiz_timer").brainpress_timer({toggle_element:a(".quiz_timer").siblings(".module-quiz-questions"),seconds:parseInt(a(".quiz_timer").attr("data-time")),action:"none",running:!1}),a(".quiz_timer").on("timer_started",function(){}),a(".quiz_timer").on("timer_ended",function(){}),null!==location.hash.match(/^#comment-/)&&a("html, body").animate({scrollTop:a(location.hash).offset().top},0);var b=a(".course-structure-block ul.tree");b.length&&(a(".module",b).removeClass("current-module"),a(".module-"+f.item_id,b).addClass("current-module"));var c=a(".course-redirect-data");if(c.length&&"unit-not-available"==c.data("redirect")){var d=_brainpress.course_url_unit_nor_available;d+="&type="+c.data("type"),d+="&id="+c.data("id")}}BrainPress.Post.prepare("course_front","focus:"),BrainPress.Post.set("action","get_unit_"+b),void 0!==c&&0!==c.length||(c=1);var e=a(".brainpress-focus-view"),f={course_id:e.attr("data-course"),unit_id:e.attr("data-unit"),type:b,item_id:c},g=e.attr("data-url");g&&g.length&&(g=g.replace("http://","//").replace("https://","//"),window.history.replaceState("","BrainPress",g)),a(".brainpress-focus-view").load(_brainpress.home_url+"/brainpress_focus/"+f.course_id+"/"+f.unit_id+"/"+f.type+"/"+f.item_id,d)};var l=function(){var b=a(".course-structure-block");if(b.length>0){var c=b.data("nonce"),d=b.data(),e=d.course,f=window.location,g={data:d,course_id:e,nonce:c};a.get(f,g,function(a){b.replaceWith(a)})}};BrainPress.Events.on("brainpress:module_change",l),BrainPress.FocusMode.init_focus_mode=function(){var b,c=null!==location.hash.match(/^#module-/),d=null!==location.hash.match(/^#section-/),e=null!==location.hash.match(/^#comment-/);if(c||d||e||(d=!0),c&&(b=location.hash.replace("#module-",""),BrainPress.FocusMode.load_focus_item("module",b)),d){if(void 0===(b=location.hash)||0===b.length){var f=a(".brainpress-focus-view");b=a(f).attr("data-page")}b=b.replace("#section-",""),BrainPress.FocusMode.load_focus_item("section",b)}e&&(b=location.hash.replace("#comment-",""),BrainPress.FocusMode.load_focus_item("comment",b))},BrainPress.Page.init=function(){var b=a(".brainpress-focus-view").length>0;f(),h(),j(),i(),b||(a(".quiz_timer").brainpress_timer(),a(".quiz_timer").on("timer_started",function(){}),a(".quiz_timer").on("timer_ended",function(){}))},BrainPress.toggleModule=function(){var b=a(this),c=b.data("module"),d=a("#cp-element-"+c);return a("#cp-response-"+c).addClass("hide"),d.removeClass("hide"),!1},a(document).ready(function(){BrainPress.Page.init(),b(),k(),e(),a("#cp-unsubscribe-message").length>0&&(a('<div class="enrolment-container-div">').html(BrainPress.Enrollment.dialog.render().el).appendTo("body"),BrainPress.Enrollment.dialog.openAtAction("unsubscribe"))}).on("click",".cp .button-reload-module",BrainPress.toggleModule),a(document).on('keydown',function(b){if(!(b.ctrlKey||b.altKey||b.shiftKey||b.metaKey)){var c=a(":focus");if(0<c.length){if(c.is("textarea"))return;if(c.is("input"))return}switch(b.which){case 37:a(".focus-nav .focus-nav-prev a").length>0&&a(".focus-nav .focus-nav-prev a").trigger("click");break;case 39:a(".focus-nav .focus-nav-next a").length>0&&a(".focus-nav .focus-nav-next a").trigger("click")}}})}(jQuery),BrainPress.current=BrainPress.current||{};