/*! BrainPress - v2.2.2
 * https://github.com/cp-psourcepiestingtal_source/ps-brainpress-classicpress-lms-online-akademie-plugin/
 * Copyright (c) 2019; * Licensed GPLv2+ */
var BrainPress=BrainPress||{};!function(a){BrainPress.Models.Course=BrainPress.Models.Course||Backbone.Model.extend({url:_brainpress._ajax_url+"?action=update_course",parse:function(a){!0===a.success?(this.set("response_data",a.data),this.trigger("brainpress:"+a.data.action+"_success",a.data)):(this.set("response_data",{}),this.trigger("brainpress:"+a.data.action+"_error",a.data)),BrainPress.Course.set("action","")},defaults:{}}),BrainPress.Course=new BrainPress.Models.Course,a(document).ready(function(a){a('[name*="publish-course-toggle"]').on("change",function(b,c){var d=a(this).attr("data-nonce"),e="off"===c?"draft":"publish",f=parseInt(a(this).attr("id").replace("publish-course-toggle-",""));BrainPress.Course.set("action","toggle_course_status");var g={nonce:d,status:e,state:c,course_id:f};BrainPress.Course.set("data",g),BrainPress.Course.save()}),BrainPress.Course.on("brainpress:toggle_course_status_success",function(b){a('[name="publish-course-toggle-'+b.course_id+'"]').attr("data-nonce",b.nonce)}),BrainPress.Course.on("brainpress:toggle_course_status_error",function(b){var c=a('[name="publish-course-toggle-'+b.course_id+'"]');a(c).hasClass("on")?a(c).removeClass("on").addClass("off"):a(c).hasClass("off")&&a(c).removeClass("off").addClass("on")}),a(".bulkactions .button.action").on("click",function(){var b=a(".nonce-holder").attr("data-nonce"),c=[],d=[];a(this).parents("form").first();if(a.each(a('[name="post[]"]'),function(b,e){a(e).is(":checked")&&(c.push(a(e).val()),d.push(a(".post_title strong",a(e).closest("tr")).html()))}),0===c.length)return!1;var e=a(this).siblings("select").val();e="-1"===e?"":e;var f=!0;if("delete"===e){f=window.confirm(_brainpress.courselist_bulk_delete);var g,h="brainpress-courses-delete-one",i={names:"",size:c.length};1==c.length?i.names=d.join():(h="brainpress-courses-delete-more",i.names="<ul><li>"+d.join("</li><li>")+"</ul>"),g=wp.template(h),a("#wpbody-content h1").after(g(i))}if("export"===e){if(0===c.length)return alert(_brainpress.courselist_export),!1;var j="&";a.each(c,function(a,b){j+="brainpress[courses]["+b+"]="+b+"&"});var k=a(".export-nonce-holder").attr("data-nonce");return window.location="./admin.php?page=brainpress_export"+j+"brainpress_export="+k,!1}if(e.length>0&&f){BrainPress.Course.set("action","bulk_actions");var i={nonce:b,the_action:e,courses:c};BrainPress.Course.set("data",i),BrainPress.Course.save()}}),BrainPress.Course.on("brainpress:bulk_actions_success",function(b){a(".nonce-holder").attr("data-nonce",b.nonce),window.location.reload()}),BrainPress.Course.on("brainpress:bulk_actions_error",function(){window.location.reload()}),a(".delete-course-link").on("click",function(b){b.stopImmediatePropagation(),b.preventDefault();var c=a(this),d=c.parents("tr").first();if(window.confirm(_brainpress.courselist_delete_course)){e={names:a(".post_title strong",d).html()},template=wp.template("brainpress-courses-delete-one"),a("#wpbody-content h1").after(template(e)),BrainPress.Course.set("action","delete_course");var e={nonce:a(this).attr("data-nonce"),course_id:a(this).attr("data-id")};BrainPress.Course.set("data",e),BrainPress.Course.save(),BrainPress.Course.off("brainpress:delete_course_success"),BrainPress.Course.on("brainpress:delete_course_success",function(){window.location.reload()}),BrainPress.Course.on("brainpress:delete_course_error",function(){alert(_brainpress.server_error)})}}),a(".duplicate-course-link").on("click",function(b){var c;b.stopImmediatePropagation(),b.preventDefault();var d=a(this),e=d.parents("tr").first();window.confirm(_brainpress.courselist_duplicate_course)&&(c={names:a(".post_title strong",e).html()},template=wp.template("brainpress-courses-duplicate"),a("#wpbody-content h1").after(template(c)),BrainPress.Course.set("action","duplicate_course"),c={nonce:a(this).attr("data-nonce"),course_id:a(this).attr("data-id")},e.addClass("duplicating"),BrainPress.Course.set("data",c),BrainPress.Course.save(),BrainPress.Course.off("brainpress:duplicate_course_success"),BrainPress.Course.on("brainpress:duplicate_course_success",function(){window.location.reload()}))}),a(".brainpress-ui-toggle-switch").brainpress_ui_toggle()})}(jQuery);